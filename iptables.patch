diff -u -r --unidirectional-new-file android-source/external/iptables/Android.mk iptables/Android.mk
--- android-source/external/iptables/Android.mk	2012-05-30 14:16:39.408709076 +0400
+++ iptables/Android.mk	2012-05-30 18:50:01.378032668 +0400
@@ -1,5 +1,3 @@
-BUILD_IPTABLES_V14 := 1
-
 LOCAL_PATH:= $(call my-dir)
 
 include $(call all-subdir-makefiles)
diff -u -r --unidirectional-new-file android-source/external/iptables/build-iptables.sh iptables/build-iptables.sh
--- android-source/external/iptables/build-iptables.sh	1970-01-01 03:00:00.000000000 +0300
+++ iptables/build-iptables.sh	2012-05-31 11:25:18.739892204 +0400
@@ -0,0 +1,4 @@
+#/bin/sh
+
+python extensions/fixinit.py
+ndk-build NDK_PROJECT_PATH=. APP_BUILD_SCRIPT=./Android.mk
diff -u -r --unidirectional-new-file android-source/external/iptables/extensions/Android.mk iptables/extensions/Android.mk
--- android-source/external/iptables/extensions/Android.mk	2012-05-30 14:16:39.411709447 +0400
+++ iptables/extensions/Android.mk	2012-05-31 11:28:15.873306310 +0400
@@ -46,7 +46,8 @@
 
 MY_initext_func := $(addprefix xt_,${MY_pfx_build_mod})
 MY_GEN_INITEXT:= $(MY_intermediates)/initext.c
-$(MY_GEN_INITEXT):
+LOCAL_GEN_INITEXT:= $(LOCAL_PATH)/$(MY_GEN_INITEXT)
+$(LOCAL_GEN_INITEXT): 
 	@mkdir -p $(dir $@)
 	@( \
 	echo "" >$@; \
@@ -76,7 +77,7 @@
 
 $(MY_intermediates)/initext.o : $(MY_GEN_INITEXT) $(MY_gen_lib_sources)
 
-LOCAL_GENERATED_SOURCES:= $(MY_GEN_INITEXT) $(MY_gen_lib_sources)
+LOCAL_SRC_FILES:= $(MY_GEN_INITEXT) $(MY_gen_lib_sources)
 
 include $(BUILD_STATIC_LIBRARY)
 
@@ -109,7 +110,8 @@
 
 MY_initext4_func  := $(addprefix ipt_,${MY_pf4_build_mod})
 MY_GEN_INITEXT4:= $(MY_intermediates)/initext4.c
-$(MY_GEN_INITEXT4):
+LOCAL_GEN_INITEXT4:= $(LOCAL_PATH)/$(MY_GEN_INITEXT4)
+$(LOCAL_GEN_INITEXT4):
 	@mkdir -p $(dir $@)
 	@( \
 	echo "" >$@; \
@@ -139,7 +141,7 @@
 
 $(MY_intermediates)/initext4.o : $(MY_GEN_INITEXT4) $(MY_gen_lib_sources)
 
-LOCAL_GENERATED_SOURCES:= $(MY_GEN_INITEXT4) ${MY_gen_lib_sources}
+LOCAL_SRC_FILES:= $(MY_GEN_INITEXT4) ${MY_gen_lib_sources}
 
 include $(BUILD_STATIC_LIBRARY)
 
@@ -172,7 +174,9 @@
 
 MY_initext6_func := $(addprefix ip6t_,${MY_pf6_build_mod})
 MY_GEN_INITEXT6:= $(MY_intermediates)/initext6.c
-$(MY_GEN_INITEXT6):
+LOCAL_GEN_INITEXT6:= $(LOCAL_PATH)/$(MY_GEN_INITEXT6)
+$(LOCAL_GEN_INITEXT6):
+	echo $(dir $@)
 	@mkdir -p $(dir $@)
 	@( \
 	echo "" >$@; \
@@ -202,7 +206,7 @@
 
 $(MY_intermediates)/initext6.o : $(MY_GEN_INITEXT6) $(MY_gen_lib_sources)
 
-LOCAL_GENERATED_SOURCES:= $(MY_GEN_INITEXT6) $(MY_gen_lib_sources)
+LOCAL_SRC_FILES:= $(MY_GEN_INITEXT6) $(MY_gen_lib_sources)
 
 include $(BUILD_STATIC_LIBRARY)
 
diff -u -r --unidirectional-new-file android-source/external/iptables/extensions/fixinit.py iptables/extensions/fixinit.py
--- android-source/external/iptables/extensions/fixinit.py	1970-01-01 03:00:00.000000000 +0300
+++ iptables/extensions/fixinit.py	2012-05-31 00:35:59.927307126 +0400
@@ -0,0 +1,31 @@
+#!/usr/bin/python
+# Author: Rodrigo Zechin Rosauro
+"""
+This script will convert all _init() functions on iptables extension sources in order
+to compile then on Android.
+This will for example, convert "void _init(void)" on libipt_LOG.c to "void libipt_LOG_init(void)".
+This is necessary because we cannot use the "-D_INIT=$*_init" on LOCAL_CFLAGS due to the way NDK works.
+"""
+
+import sys, os, glob, re
+
+def main():
+    regex=re.compile(r"[^\w]_init\s*\(")
+    os.chdir(os.path.dirname(os.path.abspath(__file__)))
+    for prefix in ("libxt", "libipt", "libip6t"):
+        for src in glob.glob("%s_*.c"%prefix):
+            name = src.replace(".c","")
+            f=open(src, "r")
+            data=f.read()
+            f.close()
+            if regex.search(data):
+                print "Converting %s..."%src
+                data=regex.sub(" %s_init("%name, data)
+                f=open(src, "w")
+                f.write(data)
+                f.close()
+    print "DONE!"
+
+if __name__=="__main__":
+    main()
+
